<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta property="og:type" content="website">
<meta property="og:title" content="Jerry&#39;s Blog">
<meta property="og:url" content="http://yoursite.com/page/3/index.html">
<meta property="og:site_name" content="Jerry&#39;s Blog">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Jerry&#39;s Blog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/3/">





  <title>Jerry's Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Jerry's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/07/07/vue组件通信/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jerry">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jerry's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/07/07/vue组件通信/" itemprop="url">vue组件通信</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-07-07T10:00:40+08:00">
                2020-07-07
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/前端/" itemprop="url" rel="index">
                    <span itemprop="name">前端</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="封装组件过程"><a href="#封装组件过程" class="headerlink" title="封装组件过程"></a>封装组件过程</h2><h3 id="注册组件"><a href="#注册组件" class="headerlink" title="注册组件"></a>注册组件</h3><h4 id="全局组件"><a href="#全局组件" class="headerlink" title="全局组件"></a>全局组件</h4><p>注册</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">  import Vue from &apos;vue&apos;;</span><br><span class="line">  </span><br><span class="line">  var globalComponent = &#123;</span><br><span class="line">    template:&quot;&lt;div&gt;&lt;button @click=&apos;add()&apos;&gt;&#123;&#123;value&#125;&#125;:&#123;&#123;account&#125;&#125;&lt;/button&gt;&lt;/div&gt;&quot;,</span><br><span class="line">    data:function()&#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        value:&apos;我是全局组件返回值&apos;,</span><br><span class="line">        account:0</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods:&#123;</span><br><span class="line">      add:function()&#123;</span><br><span class="line">        this.account++</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  Vue.component(&apos;global-component&apos;,globalComponent)</span><br><span class="line"></span><br><span class="line">  export default &#123;</span><br><span class="line">    data()&#123;</span><br><span class="line">      return &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>使用：直接使用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;global-component&gt;&lt;/global-component&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h3 id="局部组件"><a href="#局部组件" class="headerlink" title="局部组件"></a>局部组件</h3><h4 id="注册"><a href="#注册" class="headerlink" title="注册"></a>注册</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id=&quot;local&quot;&gt;</span><br><span class="line">      &lt;local-component&gt;&lt;/local-component&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">var localComponent = &#123;</span><br><span class="line">  template: &quot;&lt;div&gt;&lt;button @click=add()&gt;&#123;&#123;account&#125;&#125;&lt;/button&gt;&lt;/div&gt;&quot;,</span><br><span class="line">  data()&#123;</span><br><span class="line">    return&#123;</span><br><span class="line">      account:0</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods:&#123;</span><br><span class="line">    add()&#123;</span><br><span class="line">      this.account++</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  components:&#123;</span><br><span class="line">    &quot;local-component&quot;:localComponent</span><br><span class="line">  &#125;,</span><br><span class="line">  data()&#123;</span><br><span class="line">    return &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>别的页面使用组件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id=&quot;local&quot;&gt;</span><br><span class="line">      &lt;local-component&gt;&lt;/local-component&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"></span><br><span class="line">import localComponent from &apos;./localComponent&apos;</span><br><span class="line">export default &#123;</span><br><span class="line">  components:&#123;</span><br><span class="line">    &quot;local-component&quot;:localComponent</span><br><span class="line">  &#125;,</span><br><span class="line">  data()&#123;</span><br><span class="line">    return&#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h2 id="组件之间通信"><a href="#组件之间通信" class="headerlink" title="组件之间通信"></a>组件之间通信</h2><p>组件是 vue.js最强大的功能之一，而组件实例的作用域是相互独立的，这就意味着不同组件之间的数据无法相互引用。</p>
<h3 id="1、props-emit"><a href="#1、props-emit" class="headerlink" title="1、props/$emit"></a>1、props/$emit</h3><h4 id="1-1、父组件向子组件传值"><a href="#1-1、父组件向子组件传值" class="headerlink" title="1.1、父组件向子组件传值"></a>1.1、父组件向子组件传值</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">// 子组件</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">      &lt;li v-for=&quot;(user,index) in users&quot; :key=index&gt;&#123;&#123;user&#125;&#125;&lt;/li&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name:&apos;child&apos;,</span><br><span class="line">  props:&#123;</span><br><span class="line">    users:&#123;  //父组件即将传进来的</span><br><span class="line">      type:Array,</span><br><span class="line">      required:true</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">// 父组件</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;child-component v-bind:users=&quot;canshu&quot;&gt;&lt;/child-component&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"></span><br><span class="line">import Users from &apos;./childComponent&apos;</span><br><span class="line">export default &#123;</span><br><span class="line">  data()&#123;</span><br><span class="line">    return&#123;</span><br><span class="line">      canshu:[&apos;tom&apos;,&apos;jerry&apos;,&apos;mary&apos;]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  components:&#123;</span><br><span class="line">    &apos;child-component&apos;:Users</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h4 id="1-2、子组件向父组件传值（通过事件形式）"><a href="#1-2、子组件向父组件传值（通过事件形式）" class="headerlink" title="1.2、子组件向父组件传值（通过事件形式）"></a>1.2、子组件向父组件传值（通过事件形式）</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">// 子组件</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;h1 @click=&quot;changeTitle&quot;&gt;&#123;&#123;title&#125;&#125;&lt;/h1&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data()&#123;</span><br><span class="line">    return&#123;</span><br><span class="line">      title:&apos;Vue.js demo&apos;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods:&#123;</span><br><span class="line">    changeTitle()&#123;</span><br><span class="line">      console.log(&apos;son-emit&apos;)</span><br><span class="line">      this.$emit(&quot;titleChanged&quot;,&quot;子组件向父组件传值&quot;);</span><br><span class="line">      </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">// 父组件</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;son-component v-on:titleChanged=&quot;updateTitle&quot;&gt;&lt;/son-component&gt;</span><br><span class="line">    &lt;h1&gt;&#123;&#123;title&#125;&#125;&lt;/h1&gt;  //点击后变：为子组件向父组件传值</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import SonComponent from &apos;./son&apos;</span><br><span class="line"></span><br><span class="line">export default&#123;</span><br><span class="line">  data()&#123;</span><br><span class="line">    return&#123;</span><br><span class="line">      title:&apos;尚未传值&apos;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  methods:&#123;</span><br><span class="line">    updateTitle(e)&#123;</span><br><span class="line">      this.title = e;</span><br><span class="line">       console.log(this.title)</span><br><span class="line">     </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">    components:&#123;</span><br><span class="line">    &quot;son-component&quot;:SonComponent</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h3 id="2、-emit-on"><a href="#2、-emit-on" class="headerlink" title="2、 $emit/$on"></a>2、 $emit/$on</h3><p>这种方法通过一个空的Vue实例作为中央事件总线（事件中心），用它来触发事件和监听事件,巧妙而轻量地实现了任何组件间的通信，包括父子、兄弟、跨级。当我们的项目比较大时，可以选择更好的状态管理解决方案vuex</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">// 组件A</span><br><span class="line">&lt;template id=&quot;a&quot;&gt;</span><br><span class="line">  &lt;my-a&gt;&lt;/my-a&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import Bus from &apos;./bus&apos;;</span><br><span class="line">var A = &#123;</span><br><span class="line">  template:&apos; &lt;div&gt;&lt;h1&gt;A组件：&#123;&#123;name&#125;&#125;&lt;/h1&gt;&lt;button @click=&quot;send()&quot;&gt;A组件向C发送消息&lt;/button&gt;&lt;/div&gt;&apos;,</span><br><span class="line">  data()&#123;</span><br><span class="line">    return&#123;</span><br><span class="line">      name:&apos;jerry&apos;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods:&#123;</span><br><span class="line">    send()&#123;</span><br><span class="line">      Bus.$emit(&apos;data-a&apos;,this.name)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">export default &#123;</span><br><span class="line">  components:&#123;</span><br><span class="line">    &apos;my-a&apos;:A</span><br><span class="line"> &#125;,</span><br><span class="line">  data()&#123;</span><br><span class="line">    return&#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">// 组件B</span><br><span class="line">&lt;template id=&quot;b&quot;&gt;</span><br><span class="line">  &lt;my-b&gt;&lt;/my-b&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import Bus from &apos;./bus&apos;;</span><br><span class="line">var B = &#123;</span><br><span class="line">  template:&apos;&lt;div&gt;&lt;h1&gt;B组件：&#123;&#123;age&#125;&#125;&lt;/h1&gt;&lt;button @click=&quot;send()&quot;&gt;B组件向C发送消息&lt;/button&gt;&lt;/div&gt;&apos;,</span><br><span class="line">  data()&#123;</span><br><span class="line">    return&#123;</span><br><span class="line">      age:22</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods:&#123;</span><br><span class="line">    send()&#123;</span><br><span class="line">      Bus.$emit(&apos;data-b&apos;,this.age)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  components:&#123;</span><br><span class="line">    &apos;my-b&apos;:B</span><br><span class="line"> &#125;,</span><br><span class="line">  data()&#123;</span><br><span class="line">    return&#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">// 组件C</span><br><span class="line">&lt;template id=&quot;c&quot;&gt;</span><br><span class="line">  &lt;my-c&gt;&lt;/my-c&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import Bus from &apos;./bus&apos;;</span><br><span class="line">var C = &#123;</span><br><span class="line">  template:&apos;&lt;div&gt;&lt;h1&gt;C组件：&#123;&#123;name&#125;&#125;:&#123;&#123;age&#125;&#125;&lt;/h1&gt;&lt;/div&gt;&apos;,</span><br><span class="line">  data()&#123;</span><br><span class="line">    return&#123;</span><br><span class="line">      name:&apos;&apos;,</span><br><span class="line">      age:null</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  mounted()&#123;</span><br><span class="line">    Bus.$on(&apos;data-a&apos;,(name)=&gt;&#123;</span><br><span class="line">      this.name = name</span><br><span class="line">    &#125;);</span><br><span class="line">    Bus.$on(&apos;data-b&apos;,(age)=&gt;&#123;</span><br><span class="line">      this.age = age</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">export default &#123;</span><br><span class="line">  components:&#123;</span><br><span class="line">    &apos;my-c&apos;:C</span><br><span class="line"> &#125;,</span><br><span class="line">  data()&#123;</span><br><span class="line">    return&#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">// index.vue</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;my-a&gt;&lt;/my-a&gt;</span><br><span class="line">    &lt;my-b&gt;&lt;/my-b&gt;</span><br><span class="line">    &lt;my-c&gt;&lt;/my-c&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import A from &apos;./componentA&apos;</span><br><span class="line">import B from &apos;./componentB&apos;</span><br><span class="line">import C from &apos;./componentC&apos;</span><br><span class="line">export default &#123;</span><br><span class="line">    components:&#123;</span><br><span class="line">    &apos;my-a&apos;:A,</span><br><span class="line">    &apos;my-b&apos;:B,</span><br><span class="line">    &apos;my-c&apos;:C</span><br><span class="line">  &#125;,</span><br><span class="line">  data()&#123;</span><br><span class="line">    return&#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>$on 监听了自定义事件 data-a和data-b，因为有时不确定何时会触发事件，一般会在 mounted 或 created 钩子中来监听。</p>
<h3 id="3、Vuex"><a href="#3、Vuex" class="headerlink" title="3、Vuex"></a>3、Vuex</h3><p>Vuex 是专门为vue应用程序开发的状态管理模式。集中式存储管理所有组件的状态。vuex 实现了一个单向数据流。</p>
<p><img src="https://s1.ax1x.com/2020/07/06/UPbOvq.png" alt="image"></p>
<p>但是当多个组件共享状态时，单向数据流的简洁性很容易破坏：</p>
<ol>
<li>多个视图依赖同一状态：传参困难繁琐。</li>
<li>来自不同的视图行为需要改变同一状态。</li>
</ol>
<p>Vuex 可以帮我们管理共享状态。</p>
<h4 id="3-1-准备"><a href="#3-1-准备" class="headerlink" title="3.1 准备"></a>3.1 准备</h4><p>安装：</p>
<blockquote>
<p>npm install vuex –save</p>
</blockquote>
<p>创建store/index.js;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import Vue from &apos;vue&apos;;</span><br><span class="line">import Vuex from &apos;vuex&apos;;</span><br><span class="line"></span><br><span class="line">Vue.use(Vuex);</span><br><span class="line"></span><br><span class="line">const store = new Vuex.Store(&#123;</span><br><span class="line">  state:&#123;</span><br><span class="line">    count:12</span><br><span class="line">  &#125;,</span><br><span class="line">  mutations:&#123;</span><br><span class="line">    toIncrease(state)&#123;</span><br><span class="line">      state.count++</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">export default store;</span><br></pre></td></tr></table></figure>

<p>为了在所有组件上可以使用，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import store from &apos;./store&apos;</span><br><span class="line"></span><br><span class="line">new Vue(&#123;</span><br><span class="line">  el: &apos;#app&apos;,</span><br><span class="line">  router,</span><br><span class="line">  store,</span><br><span class="line">  components: &#123; App &#125;,</span><br><span class="line">  template: &apos;&lt;App/&gt;&apos;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>简单使用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data()&#123;</span><br><span class="line">    return&#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  created()&#123;</span><br><span class="line">    console.log(this.$store.state.count)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>只能通过提交mutation的方式，改变state</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;button @click=&quot;increment&quot;&gt;increase&lt;/button&gt;</span><br><span class="line">    &lt;div&gt;&#123;&#123;$store.state.count&#125;&#125;&lt;/div&gt;</span><br><span class="line">    &lt;!--数据会响应式的更新--&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data()&#123;</span><br><span class="line">    return&#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  created()&#123;</span><br><span class="line">    console.log(this.$store.state.count)</span><br><span class="line">  &#125;,</span><br><span class="line">  methods:&#123;</span><br><span class="line">    increment()&#123;</span><br><span class="line">      this.$store.commit(&apos;toIncrease&apos;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h4 id="3-2-核心内容"><a href="#3-2-核心内容" class="headerlink" title="3.2 核心内容"></a>3.2 核心内容</h4><ul>
<li>store: 是Vuex 的核心，是一个容器，包含着应用中的大部分状态。Vuex 和全局对象存在两个不同：</li>
</ul>
<ol>
<li>Vuex 的状态存储是响应式的。当 Vue 组件从 store 中读取状态的时候，若 store 中的状态发生变化，那么相应的组件也会相应地得到高效更新。</li>
<li>你不能直接改变 store 中的状态。改变 store 中的状态的唯一途径就是显式地提交 (commit) mutation。</li>
</ol>
<ul>
<li><p>mutations:是操作state数据的方法的集合</p>
</li>
<li><p>getters:加工state成员给外界</p>
</li>
<li><p>actions:异步操作(调接口后将对数据进行操作)，ue组件如果调用某个VueX的方法过程中需要向后端请求时或者说出现异步操作时，需要dispatch VueX中actions的方法，以保证数据的同步。可以说，action的存在就是为了让mutations中的方法能在异步操作中起作用。如果没有异步操作，那么我们就可以直接在组件内提交状态中的Mutations中自己编写的方法来达成对state成员的操作。注意，1.3.3节中有提到，不建议在组件中直接对state中的成员进行操作，这是因为直接修改(例如：this.$store.state.name = ‘hello’)的话不能被VueDevtools所监控到。</p>
</li>
<li><p>modules:模块化状态管理</p>
</li>
</ul>
<h4 id="3-3-mutations使用"><a href="#3-3-mutations使用" class="headerlink" title="3.3 mutations使用"></a>3.3 mutations使用</h4><p>参数：([state] [,payload])</p>
<ul>
<li>state是当前VueX对象中的state</li>
<li>payload是该方法在被调用时传递参数使用的（比如你想把state中的状态修改成的值等）</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">import Vue from &apos;vue&apos;</span><br><span class="line">import Vuex from &apos;vuex&apos;</span><br><span class="line"></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line">const store = new Vuex.store(&#123;</span><br><span class="line">    state:&#123;</span><br><span class="line">        name:&apos;helloVueX&apos;</span><br><span class="line">    &#125;,</span><br><span class="line">    mutations:&#123;</span><br><span class="line">        //es6语法，等同edit:funcion()&#123;...&#125;</span><br><span class="line">        edit(state)&#123;</span><br><span class="line">            state.name = &apos;jack&apos;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">export default store</span><br><span class="line"></span><br><span class="line">// 使用</span><br><span class="line">onemethod()&#123;</span><br><span class="line">    this.$store.commit(&apos;edit&apos;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实际使用时可能会需要向mutations中传递一些参数，传递单个值时直接后续传参即可，传递多个值时，要将多个参数放到对象中。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">this.$store.commit(&apos;edit&apos;,15)</span><br><span class="line">this.$store.commit(&apos;edit&apos;,&#123;age:15,sex:&apos;男&apos;&#125;)</span><br></pre></td></tr></table></figure>

<p>接收参数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">edit(state,payload)&#123;</span><br><span class="line">    state.name = &apos;jack&apos;</span><br><span class="line">    console.log(payload) // 15或&#123;age:15,sex:&apos;男&apos;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>还有一种提交方式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">this.$store.commit(&#123;</span><br><span class="line">    type:&apos;edit&apos;,</span><br><span class="line">    payload:&#123;</span><br><span class="line">        age:15,</span><br><span class="line">        sex:&apos;男&apos;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>为了配合Vue的响应式数据，我们在Mutations的方法中，应当使用Vue提供的方法来进行操作。如果使用delete或者xx.xx = xx的形式去删或增，则Vue不能对数据进行实时响应。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Vue.set(state,&quot;age&quot;,15) // 向state中添加age成员</span><br><span class="line">Vue.delete(state,&apos;age&apos;) // 删除state中age成员</span><br></pre></td></tr></table></figure>

<h4 id="3-4-getters"><a href="#3-4-getters" class="headerlink" title="3.4 getters"></a>3.4 getters</h4><p>Getters中的方法有两个默认参数</p>
<ul>
<li>state 当前VueX对象中的状态对象</li>
<li>getters 当前getters对象，用于将getters下的其他getter拿来用</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">getters:&#123;</span><br><span class="line">    nameInfo(state)&#123;</span><br><span class="line">        return &quot;姓名:&quot;+state.name</span><br><span class="line">    &#125;,</span><br><span class="line">    fullInfo(state,getters)&#123;</span><br><span class="line">        return getters.nameInfo+&apos;年龄:&apos;+state.age</span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 调用</span><br><span class="line">this.$store.getters.fullInfo</span><br></pre></td></tr></table></figure>

<h4 id="3-5-Actions"><a href="#3-5-Actions" class="headerlink" title="3.5 Actions"></a>3.5 Actions</h4><p>由于直接在mutation方法中进行异步操作，将会引起数据失效。所以提供了Actions来专门进行异步操作，最终提交mutation方法。</p>
<p>Actions中的方法有两个默认参数</p>
<ul>
<li>context 上下文(相当于箭头函数中的this)对象</li>
<li>payload 挂载参数</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">actions:&#123;</span><br><span class="line">    aEdit(context,payload)&#123;</span><br><span class="line">        setTimeout(()=&gt;&#123;</span><br><span class="line">            context.commit(&apos;edit&apos;,payload)</span><br><span class="line">        &#125;,2000)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 使用</span><br><span class="line">this.$store.dispatch(&apos;aEdit&apos;,&#123;age:15&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="3-6-Models"><a href="#3-6-Models" class="headerlink" title="3.6 Models"></a>3.6 Models</h4><p>当项目庞大，状态非常多时，可以采用模块化管理模式。Vuex 允许我们将 store 分割成模块（module）。每个模块拥有自己的 state、mutation、action、getter、甚至是嵌套子模块——从上至下进行同样方式的分割。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">models:&#123;</span><br><span class="line">    a:&#123;</span><br><span class="line">        state:&#123;&#125;,</span><br><span class="line">        getters:&#123;&#125;,</span><br><span class="line">        ....</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>调用时不变：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">this.$store.state.a</span><br><span class="line">this.$store.commit(&apos;editKey&apos;)</span><br><span class="line">this.$store.dispatch(&apos;aEditKey&apos;)</span><br></pre></td></tr></table></figure>

<p>注意：</p>
<ul>
<li>模块中mutations和getters中的方法接受的第一个参数是自身局部模块内部的state</li>
<li>getters中方法的第三个参数是根节点状态（rootState）</li>
<li>actions中方法获取局部模块状态是context.state,根节点状态是context.rootState</li>
</ul>
<h4 id="3-7-Vuex和localStorage"><a href="#3-7-Vuex和localStorage" class="headerlink" title="3.7 Vuex和localStorage"></a>3.7 Vuex和localStorage</h4><p>Vuex是vue的状态管理器，存储数据时响应式的，但是并不会保存起来，刷新之后就回到了出初始状态。想要保存的话就将state中数据保存到localstorage里边，刷新之后再用localstorage来替换state。但是state里边都是数组，而localstorage里边只支持字符串，岁哦医药转化成字符串。</p>
<h4 id="attrs-listeners"><a href="#attrs-listeners" class="headerlink" title="$attrs/$listeners"></a>$attrs/$listeners</h4><p>多级组件嵌套需要传递数据时，通常使用vuex，但是如果仅仅传递数据不做中间处理，使用vuex处理有点大材小用，vue2.4版本提供了另一种方法$attrs/$listeners</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul>
<li>父子通信</li>
</ul>
<ol>
<li>父-&gt;子：props</li>
<li>子-&gt;父：$emit</li>
</ol>
<ul>
<li>兄弟通信：Bus;Vuex</li>
<li>跨级通信：Bus;Vuex;$attrs/$listeners</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/07/06/vue项目准备及创建/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jerry">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jerry's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/07/06/vue项目准备及创建/" itemprop="url">vue项目准备及创建</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-07-06T17:13:54+08:00">
                2020-07-06
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/前端/" itemprop="url" rel="index">
                    <span itemprop="name">前端</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="新建项目"><a href="#新建项目" class="headerlink" title="新建项目"></a>新建项目</h2><ul>
<li>安装全局 vue-cli<blockquote>
<p>$ cnpm install –global vue-cli</p>
</blockquote>
</li>
<li>创建一个项目<blockquote>
<p>$vue init webpack blog</p>
</blockquote>
</li>
<li>westorem打开项目<blockquote>
<p>$npm install<br>$npm run dev</p>
</blockquote>
</li>
<li>问题</li>
</ul>
<ol>
<li><p>新建项目报错</p>
<p> 升级npm </p>
<blockquote>
<p>$cnpm install npm</p>
</blockquote>
<p> 升级或安装cnpm</p>
<blockquote>
<p>$npm install cnpm</p>
</blockquote>
<p> 安装最新稳定版vue</p>
<blockquote>
<p>$cnpm install vue</p>
</blockquote>
</li>
</ol>
<h2 id="axios"><a href="#axios" class="headerlink" title="axios"></a>axios</h2><ul>
<li><p>安装</p>
<blockquote>
<p>$npm install –save axios</p>
</blockquote>
</li>
<li><p>设置拦截器</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--http.js--&gt;</span><br><span class="line"></span><br><span class="line">import axios from &apos;axios&apos;;</span><br><span class="line"></span><br><span class="line">axios.interceptors.request.use(</span><br><span class="line">  config =&gt; &#123;</span><br><span class="line">    console.log(&apos;请求拦截---&gt;&apos;, config);</span><br><span class="line">    return config;</span><br><span class="line">  &#125;,</span><br><span class="line">  error =&gt; &#123;</span><br><span class="line">    console.log(&apos;请求错误拦截---&gt;&apos;, error);</span><br><span class="line">    return Promise.reject(error);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">axios.interceptors.response.use(</span><br><span class="line">  response =&gt; &#123;</span><br><span class="line">    console.log(&apos;响应拦截---&gt;&apos;, response);</span><br><span class="line">    return response;</span><br><span class="line">  &#125;,</span><br><span class="line">  error =&gt; &#123;</span><br><span class="line">    console.log(&apos;响应错误拦截---&gt;&apos;, error);</span><br><span class="line">    return Promise.reject(error);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line">export default axios;</span><br></pre></td></tr></table></figure>

<ul>
<li>全局引入axios</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--main.js--&gt;</span><br><span class="line"></span><br><span class="line">import http from &apos;./http&apos;;</span><br><span class="line">Vue.prototype.$http = http;</span><br></pre></td></tr></table></figure>

<ul>
<li>使用axios</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--GET--&gt;</span><br><span class="line"></span><br><span class="line">getOneArticle() &#123;</span><br><span class="line">      this.$http</span><br><span class="line">        .get(URL)</span><br><span class="line">        .then(res =&gt; &#123;</span><br><span class="line">          console.log(&quot;getOneArticle=&gt;&quot;, res);</span><br><span class="line">          this.article = res.data.data;</span><br><span class="line">        &#125;</span><br><span class="line">        .catch(err=&gt;&#123;</span><br><span class="line">        console.log(err);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&lt;!--POST--&gt;</span><br><span class="line"></span><br><span class="line">login() &#123;</span><br><span class="line">      let 参数 = &#123;</span><br><span class="line">        user_name: this.username,</span><br><span class="line">        password: this.password</span><br><span class="line">      &#125;;</span><br><span class="line">      this.$http.post(URL, 发送参数)</span><br><span class="line">        .then(res =&gt; &#123;</span><br><span class="line">          </span><br><span class="line">        &#125;)</span><br><span class="line">        .catch(err=&gt;&#123;</span><br><span class="line">            </span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>

<ul>
<li>问题 </li>
</ul>
<ol>
<li>cnpm install axios 会报错</li>
</ol>
<h2 id="新建页面"><a href="#新建页面" class="headerlink" title="新建页面"></a>新建页面</h2><ul>
<li>新建文件夹文件</li>
<li>注册路由</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--router/index.js--&gt;</span><br><span class="line"></span><br><span class="line">import Login from &apos;@/components/login/login&apos;</span><br><span class="line"></span><br><span class="line">routers:[</span><br><span class="line">    &#123;</span><br><span class="line">        path: &apos;/&apos;,     //默认进入的页面</span><br><span class="line">        name: &apos;login&apos;,</span><br><span class="line">        component: Login</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        path: &apos;/login/login&apos;,    //非默认进入的页面</span><br><span class="line">        name: &apos;login&apos;,</span><br><span class="line">        component: Login</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<ul>
<li>问题</li>
</ul>
<ol>
<li>当login文件夹下为index.vue时；this.$router.push(name)未发生跳转；当login文件夹下是login.vue时，可以完成页面跳转。<h2 id="引入element-UI"><a href="#引入element-UI" class="headerlink" title="引入element UI"></a>引入element UI</h2></li>
</ol>
<ul>
<li><p>安装</p>
<blockquote>
<p>$npm i element-ui -S</p>
</blockquote>
</li>
<li><p>引入</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--main.js--&gt;</span><br><span class="line"></span><br><span class="line">import ElementUI from &apos;element-ui&apos;</span><br><span class="line">import &apos;element-ui/lib/theme-chalk/index.css&apos;</span><br><span class="line"></span><br><span class="line">Vue.use(ElementUI);</span><br></pre></td></tr></table></figure>

<h2 id="全局接口"><a href="#全局接口" class="headerlink" title="全局接口"></a>全局接口</h2><ul>
<li><p>编辑接口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--globalVar/index.js--&gt;</span><br><span class="line"></span><br><span class="line">const Ip = &apos;http://tom-jerry.club&apos;;</span><br><span class="line"></span><br><span class="line">const apiConfig = &#123;</span><br><span class="line">//  定义接口</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  apiConfig: apiConfig</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>全局变量引入接口</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--main.js--&gt;</span><br><span class="line"></span><br><span class="line">import globalVar from &apos;./globalVar&apos;</span><br><span class="line">Vue.prototype.globalVar = globalVar;</span><br></pre></td></tr></table></figure>

<p>或者将接口方法抽出来放到对应的api文件夹中。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/07/06/MVVM/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jerry">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jerry's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/07/06/MVVM/" itemprop="url">MVVM</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-07-06T17:05:22+08:00">
                2020-07-06
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/前端/" itemprop="url" rel="index">
                    <span itemprop="name">前端</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="View-视图层"><a href="#View-视图层" class="headerlink" title="View:视图层"></a>View:视图层</h3><p>前端所说的DOM,通常给用户展示各种信息。</p>
<h3 id="Model-数据层"><a href="#Model-数据层" class="headerlink" title="Model:数据层"></a>Model:数据层</h3><p>里面存放着各种数据，有我们写死的固定数据，大多数是从网上请求过来的数据。</p>
<h3 id="VIewModel：视图模型层"><a href="#VIewModel：视图模型层" class="headerlink" title="VIewModel：视图模型层"></a>VIewModel：视图模型层</h3><p>它是View和Model的桥梁，</p>
<p>一是实现Data Bindings也就是<strong>数据绑定</strong>，将Model中的数据的改变同步到View中去。</p>
<p>二是DOM Listeners,也就<strong>是DOM监听</strong>，当DOM发生一些事件(点击，滚动，touch等)可以监听到，并且改变对应的Data.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/07/06/观察者模式和发布订阅模式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jerry">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jerry's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/07/06/观察者模式和发布订阅模式/" itemprop="url">观察者模式和发布订阅模式</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-07-06T16:44:37+08:00">
                2020-07-06
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/前端/" itemprop="url" rel="index">
                    <span itemprop="name">前端</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="观察者模式"><a href="#观察者模式" class="headerlink" title="观察者模式"></a>观察者模式</h3><p>观察者模式定义了对象间的一种一对多的依赖关系，当一个对象的状态发生改变时，所有依赖于它的对象都将得到通知，并自动更新。观察者模式属于行为型模式，行为型模式关注的是对象之间的通讯，观察者模式就是观察者和被观察者之间的通讯。</p>
<h3 id="发布订阅模式"><a href="#发布订阅模式" class="headerlink" title="发布订阅模式"></a>发布订阅模式</h3><p>发布订阅模式开始只是观察者模式的别称，但是随着时间的沉淀越来越强大，已经独立于观察者模式，成为另外一种设计模式。</p>
<p>在现在的发布订阅模式中，称为发布者的消息发送者不会将消息直接发送给订阅者，这意味着发布者和订阅者不知道彼此的存在。在发布者和订阅者之间存在第三个组件，称为<strong>消息代理或调度中心或中间件</strong>，它维持着发布者和订阅者之间的联系，过滤所有发布者传入的消息并相应地分发它们给订阅者。</p>
<p>例子：微博上你关注了A，同时也有很多人关注了他，当A发布动态的时候，微博会为你们推送这条动态。A是发布者，你是订阅者，微博就是调度中心。</p>
<h3 id="观察者模式是不是发布订阅模式"><a href="#观察者模式是不是发布订阅模式" class="headerlink" title="观察者模式是不是发布订阅模式"></a>观察者模式是不是发布订阅模式</h3><p>如果以<strong>结构</strong>来分辨模式，发布订阅模式相比观察者模式多了一个中间件订阅器，所以发布订阅模式是不同于观察者模式的；</p>
<p>如果以<strong>意图</strong>来分辨模式，他们都是实现了对象间的一种一对多的依赖关系，当一个对象的状态发生改变时，所有依赖于它的对象都将得到通知，并自动更新，那么他们就是同一种模式，发布订阅模式是在观察者模式的基础上做的优化升级。</p>
<h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><h4 id="观察者模式："><a href="#观察者模式：" class="headerlink" title="观察者模式："></a>观察者模式：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">  //有一家猎人工会，其中每个猎人都具有发布任务(publish)，订阅任务(subscribe)的功能</span><br><span class="line">	//他们都有一个订阅列表来记录谁订阅了自己</span><br><span class="line">	//定义一个猎人类</span><br><span class="line">	//包括姓名，级别，订阅列表</span><br><span class="line">function Hunter(name,level)&#123;</span><br><span class="line">  this.name = name;</span><br><span class="line">  this.level = level;</span><br><span class="line">  this.list = [];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Hunter.prototype.publish = function(money)&#123;</span><br><span class="line">  console.log(`$&#123;this.level&#125; 猎人 $&#123;this.name&#125; 寻求帮助`);</span><br><span class="line">  this.list.forEach(function(item)&#123;</span><br><span class="line">    item(money);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Hunter.prototype.subscribe = function(target,fn)&#123;</span><br><span class="line">  console.log( `$&#123;this.level&#125; 猎人 $&#123;this.name&#125; 订阅了 $&#123;target.name&#125;`);</span><br><span class="line">  target.list.push(fn)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//猎人工会走来了几个猎人</span><br><span class="line"></span><br><span class="line">var hunterMing = new Hunter(&apos;小明&apos;,&apos;黄金&apos;)</span><br><span class="line">var hunterJin = new Hunter(&apos;小金&apos;,&apos;白银&apos;)</span><br><span class="line">var hunterZhang = new Hunter(&apos;小张&apos;,&apos;黄金&apos;)</span><br><span class="line">var hunterPeter = new Hunter(&apos;peter&apos;,&apos;青铜&apos;)</span><br><span class="line"></span><br><span class="line">// perter等级低，可能需要帮助，所以都订阅peter</span><br><span class="line"></span><br><span class="line">hunterMing.subscribe(hunterPeter, function(money)&#123;</span><br><span class="line">  console.log(&apos;小明表示：&apos; + (money &gt; 200 ? &apos;&apos; : &apos;暂时很忙，不能&apos;) + &apos;给予帮助&apos;)</span><br><span class="line">&#125;)</span><br><span class="line">hunterJin.subscribe(hunterPeter, function()&#123;</span><br><span class="line">  console.log(&apos;小金表示：给予帮助&apos;)</span><br><span class="line">&#125;)</span><br><span class="line">hunterZhang.subscribe(hunterPeter, function()&#123;</span><br><span class="line">  console.log(&apos;小张表示：给予帮助&apos;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">	//Peter遇到困难，赏金198寻求帮助</span><br><span class="line">  hunterPeter.publish(198)</span><br><span class="line">  </span><br><span class="line">  /*</span><br><span class="line">  黄金 猎人 小明 订阅了 peter</span><br><span class="line">白银 猎人 小金 订阅了 peter</span><br><span class="line">黄金 猎人 小张 订阅了 peter</span><br><span class="line">青铜 猎人 peter 寻求帮助</span><br><span class="line">小明表示：暂时很忙，不能给予帮助</span><br><span class="line">小金表示：给予帮助</span><br><span class="line">小张表示：给予帮助</span><br><span class="line">*/</span><br></pre></td></tr></table></figure>

<h4 id="发布订阅模式-1"><a href="#发布订阅模式-1" class="headerlink" title="发布订阅模式"></a>发布订阅模式</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">//定义一家猎人工会</span><br><span class="line">//主要功能包括任务发布大厅(topics)，以及订阅任务(subscribe)，发布任务(publish)</span><br><span class="line">var HunterUnion = &#123;</span><br><span class="line">  type:&apos;hunter&apos;,</span><br><span class="line">  topics:Object.create(null),</span><br><span class="line"></span><br><span class="line">  subscribe:function(topic,fn)&#123;</span><br><span class="line">    if(!this.topics[topic])&#123;</span><br><span class="line">      this.topics[topic]=[]</span><br><span class="line">    &#125;</span><br><span class="line">    this.topics[topic].push(fn)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  publish:function(topic,money)&#123;</span><br><span class="line">    if(!this.topics[topic])</span><br><span class="line">      return;</span><br><span class="line">    for(let fn of this.topics[topic])&#123;</span><br><span class="line">      fn(money);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//定义一个猎人类</span><br><span class="line">	//包括姓名，级别</span><br><span class="line">	function Hunter(name, level)&#123;</span><br><span class="line">		this.name = name</span><br><span class="line">		this.level = level</span><br><span class="line">	&#125;</span><br><span class="line">	//猎人可在猎人工会发布订阅任务</span><br><span class="line">	Hunter.prototype.subscribe = function (topic, fn)&#123;</span><br><span class="line">		console.log(this.level + &apos;猎人&apos; + this.name + &apos;订阅了狩猎&apos; + topic + &apos;的任务&apos;)</span><br><span class="line">	    HunterUnion.subscribe(topic, fn)</span><br><span class="line">	&#125;</span><br><span class="line">	Hunter.prototype.publish = function (topic, money)&#123;</span><br><span class="line">		console.log(this.level + &apos;猎人&apos; + this.name + &apos;发布了狩猎&apos; + topic + &apos;的任务&apos;)</span><br><span class="line">	    HunterUnion.publish(topic, money)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  //猎人工会走来了几个猎人</span><br><span class="line">	let hunterMing = new Hunter(&apos;小明&apos;, &apos;黄金&apos;)</span><br><span class="line">	let hunterJin = new Hunter(&apos;小金&apos;, &apos;白银&apos;)</span><br><span class="line">	let hunterZhang = new Hunter(&apos;小张&apos;, &apos;黄金&apos;)</span><br><span class="line">	let hunterPeter = new Hunter(&apos;Peter&apos;, &apos;青铜&apos;)</span><br><span class="line">//小明，小金，小张分别订阅了狩猎tiger的任务</span><br><span class="line">hunterMing.subscribe(&apos;tiger&apos;, function(money)&#123;</span><br><span class="line">  console.log(&apos;小明表示：&apos; + (money &gt; 200 ? &apos;&apos; : &apos;不&apos;) + &apos;接取任务&apos;)</span><br><span class="line">&#125;)</span><br><span class="line">hunterJin.subscribe(&apos;tiger&apos;, function(money)&#123;</span><br><span class="line">  console.log(&apos;小金表示：接取任务&apos;)</span><br><span class="line">&#125;)</span><br><span class="line">hunterZhang.subscribe(&apos;tiger&apos;, function(money)&#123;</span><br><span class="line">  console.log(&apos;小张表示：接取任务&apos;)</span><br><span class="line">&#125;)</span><br><span class="line">//Peter订阅了狩猎sheep的任务</span><br><span class="line">hunterPeter.subscribe(&apos;sheep&apos;, function(money)&#123;</span><br><span class="line">  console.log(&apos;Peter表示：接取任务&apos;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">//Peter发布了狩猎tiger的任务</span><br><span class="line">hunterPeter.publish(&apos;tiger&apos;, 198)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">黄金猎人小明订阅了狩猎tiger的任务</span><br><span class="line">白银猎人小金订阅了狩猎tiger的任务</span><br><span class="line">黄金猎人小张订阅了狩猎tiger的任务</span><br><span class="line">青铜猎人Peter订阅了狩猎sheep的任务</span><br><span class="line">青铜猎人Peter发布了狩猎tiger的任务</span><br><span class="line">小明表示：不接取任务</span><br><span class="line">小金表示：接取任务</span><br><span class="line">小张表示：接取任务</span><br><span class="line">*/</span><br></pre></td></tr></table></figure>

<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul>
<li>观察者和被观察者，是松耦合的关系</li>
<li>发布者和订阅者，则完全不存在耦合</li>
<li>观察者模式，多用于单个应用内部</li>
<li>发布订阅模式，则更多的是一种跨应用的模式(cross-application pattern)，比如我们常用的消息中间件(wamp)</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/05/20/webpack-VueCli3的配置方法/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jerry">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jerry's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/05/20/webpack-VueCli3的配置方法/" itemprop="url">webpack-VueCli3的配置方法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-05-20T22:46:00+08:00">
                2020-05-20
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/前端/" itemprop="url" rel="index">
                    <span itemprop="name">前端</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>首先创建一个Vue的项目：</p>
<p>安装脚手架：</p>
<blockquote>
<p>npm install -g @vue/cli</p>
</blockquote>
<p>创建项目：</p>
<blockquote>
<p>vue create my-project</p>
</blockquote>
<p>按照要求:</p>
<blockquote>
<p>cd my-project</p>
</blockquote>
<blockquote>
<p>npm run serve</p>
</blockquote>
<p>react的理念是让用户配置起来更灵活，但是Vue不是，Vue的理念是让用户使用起来更加便利，Vue没有暴露给用户webpack配置文件，也不可以像react一样通过命令显示出来配置文件，若是想要自己配置文件，需要我们<a href="https://cli.vuejs.org/zh/config/" target="_blank" rel="noopener">查阅官网</a>并且创建vue.config.js文件配置webpack，我们可以看到Vue对webpack的配置做了很多的封装，使我们配置起来更加的方便。</p>
<p>在Vue2.x版本中存在static文件，当我们运行项目时，如果我们访问localhost:8080/index.json，浏览器会先去打包后的文件中找index.json找不到的话会去static文件中查找，vue3.x中已经没有static文件，如果我们需要相同的功能需要在vue.config.js如下配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">const path = require(&apos;path&apos;)</span><br><span class="line">module.exports=&#123;</span><br><span class="line">  configureWebpack:&#123;</span><br><span class="line">    devServer:&#123;</span><br><span class="line">      contentBase:[path.resolve(__dirname,&apos;static&apos;)]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当vue提供的配置项不能满足我们的需求时，还可以使用configureWebpack直接对webpack进行配置。但是我们上述配置是不合理的，因为vue已经提供给我们配置项devServer,正确的配置应该是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">const path = require(&apos;path&apos;)</span><br><span class="line">module.exports=&#123;</span><br><span class="line">//  configureWebpack:&#123;</span><br><span class="line">    devServer:&#123;</span><br><span class="line">      contentBase:[path.resolve(__dirname,&apos;static&apos;)]</span><br><span class="line">    &#125;</span><br><span class="line"> // &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>至于vue是怎样把我们的配置转化为webpack的配置，可以去看node_modules/@vue/cli-service/lib/Service.js</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/05/20/webpack-Bundler源码编写/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jerry">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jerry's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/05/20/webpack-Bundler源码编写/" itemprop="url">webpack-Bundler源码编写</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-05-20T22:03:02+08:00">
                2020-05-20
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/前端/" itemprop="url" rel="index">
                    <span itemprop="name">前端</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="模块分析"><a href="#模块分析" class="headerlink" title="模块分析"></a>模块分析</h3><p>编写三个模块以供分析：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// index.js</span><br><span class="line">import message from &apos;./message.js&apos;;</span><br><span class="line"></span><br><span class="line">console.log(message);</span><br><span class="line"></span><br><span class="line">//message.js</span><br><span class="line">import &#123; word &#125; from &apos;./word.js&apos;;</span><br><span class="line">const message = `say $&#123;word&#125;`;</span><br><span class="line">export default message;</span><br><span class="line"></span><br><span class="line">//word.js</span><br><span class="line">export const word = &apos;hello&apos;;</span><br></pre></td></tr></table></figure>

<p>bundler.js:(用node编写，有一定node基础)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">const fs = require(&apos;fs&apos;);</span><br><span class="line"></span><br><span class="line">const moduleAnalyser = (filename)=&gt; &#123;</span><br><span class="line">  const content = fs.readFileSync(filename,&apos;utf-8&apos;);</span><br><span class="line">  console.log(content);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">moduleAnalyser(&apos;./src/index.js&apos;)</span><br></pre></td></tr></table></figure>

<p>运行node bundler.js可以看到打印出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line">import message from &apos;./message.js&apos;;</span><br><span class="line"></span><br><span class="line">console.log(message);</span><br><span class="line">*/</span><br></pre></td></tr></table></figure>

<p>在控制台，我们看到打印出来的代码是黑色的，可以安装 cli-highlight 使打印的代码高亮：</p>
<blockquote>
<p>npm install cli-highlight -g</p>
</blockquote>
<p>运行 node bundler.js | highlight 看到代码高亮起来。</p>
<p>接下来我们看到index.js中引用了message.js模块，那我们就需要将message.js提取出来。</p>
<blockquote>
<p>npm install @babel/parser</p>
</blockquote>
<p>然后用babel进行代码分析：bundler.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">const fs = require(&apos;fs&apos;);</span><br><span class="line">const parser = require(&apos;@babel/parser&apos;)</span><br><span class="line"></span><br><span class="line">const moduleAnalyser = (filename)=&gt; &#123;</span><br><span class="line">  const content = fs.readFileSync(filename,&apos;utf-8&apos;);</span><br><span class="line">  const ast = parser.parse(content,&#123;</span><br><span class="line">    sourceType:&apos;module&apos;  //分析的文件index.js用ESmodule方式引入的</span><br><span class="line">  &#125;);</span><br><span class="line">  console.log(ast)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">moduleAnalyser(&apos;./src/index.js&apos;)</span><br></pre></td></tr></table></figure>

<p>之后运行会打印一堆东西，就是我们常说的抽象语法树，也称 ast ：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Node &#123;</span><br><span class="line">  type: &apos;File&apos;,</span><br><span class="line">  start: 0,</span><br><span class="line">  end: 60,</span><br><span class="line">  loc:</span><br><span class="line">   SourceLocation &#123;</span><br><span class="line">     start: Position &#123; line: 1, column: 0 &#125;,</span><br><span class="line">     end: Position &#123; line: 3, column: 21 &#125; &#125;,</span><br><span class="line">  errors: [],</span><br><span class="line">  program: // 当前运行的程序</span><br><span class="line">   Node &#123;</span><br><span class="line">     type: &apos;Program&apos;,</span><br><span class="line">     start: 0,</span><br><span class="line">     end: 60,</span><br><span class="line">     loc: SourceLocation &#123; start: [Position], end: [Position] &#125;,</span><br><span class="line">     sourceType: &apos;module&apos;,</span><br><span class="line">     interpreter: null,</span><br><span class="line">     body: [ [Node], [Node] ], </span><br><span class="line">     directives: [] &#125;,</span><br><span class="line">  comments: [] &#125;</span><br></pre></td></tr></table></figure>

<p>我们打印body里边的内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">console.log(ast.program.body);</span><br></pre></td></tr></table></figure>

<p>打印出program里边内容对应节点：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[ Node &#123;</span><br><span class="line">    type: &apos;ImportDeclaration&apos;, //第一个节点：引入的声明 import message...</span><br><span class="line">    start: 0,</span><br><span class="line">    end: 35,</span><br><span class="line">    loc: SourceLocation &#123; start: [Position], end: [Position] &#125;,</span><br><span class="line">    specifiers: [ [Node] ],</span><br><span class="line">    source:</span><br><span class="line">     Node &#123;</span><br><span class="line">       type: &apos;StringLiteral&apos;,</span><br><span class="line">       start: 20,</span><br><span class="line">       end: 34,</span><br><span class="line">       loc: [SourceLocation],</span><br><span class="line">       extra: [Object],</span><br><span class="line">       value: &apos;./message.js&apos; &#125; &#125;,</span><br><span class="line">  Node &#123;</span><br><span class="line">    type: &apos;ExpressionStatement&apos;, //表达式声明 console..,</span><br><span class="line">    start: 39,</span><br><span class="line">    end: 60,</span><br><span class="line">    loc: SourceLocation &#123; start: [Position], end: [Position] &#125;,</span><br><span class="line">    expression:</span><br><span class="line">     Node &#123;</span><br><span class="line">       type: &apos;CallExpression&apos;,</span><br><span class="line">       start: 39,</span><br><span class="line">       end: 59,</span><br><span class="line">       loc: [SourceLocation],</span><br><span class="line">       callee: [Node],</span><br><span class="line">       arguments: [Array] &#125; &#125; ]</span><br></pre></td></tr></table></figure>

<p>这样抽象语法树就很好地将js代码转化成了js对象。接下来要做的就是遍历program.body当中的所有节点，找到type=ImportDeclaration 的节点，babel也为我们提供了这样的工具：</p>
<blockquote>
<p>npm install @babel/traverse –save</p>
</blockquote>
<p>然后traverse 处理代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">const fs = require(&apos;fs&apos;);</span><br><span class="line">const parser = require(&apos;@babel/parser&apos;);</span><br><span class="line">const traverse =require(&apos;@babel/traverse&apos;).default //默认为ES Module 的导出，想用export default要加default </span><br><span class="line"></span><br><span class="line">const moduleAnalyser = (filename)=&gt; &#123;</span><br><span class="line">  const content = fs.readFileSync(filename,&apos;utf-8&apos;);</span><br><span class="line">  const ast = parser.parse(content,&#123;</span><br><span class="line">    sourceType:&apos;module&apos;  //分析的文件index.js用ESmodule方式引入的</span><br><span class="line">  &#125;);</span><br><span class="line">  traverse(ast,&#123;</span><br><span class="line">    ImportDeclaration(&#123;node&#125;)&#123;  //抽象语法树中只要存在ImportDeclaration语句，就会执行此函数</span><br><span class="line">      console.log(node)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">moduleAnalyser(&apos;./src/index.js&apos;)</span><br></pre></td></tr></table></figure>

<p>我们可以看到打印出node中所有节点type均为ImportDeclaration，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Node &#123;</span><br><span class="line">  type: &apos;ImportDeclaration&apos;,</span><br><span class="line">  start: 0,</span><br><span class="line">  end: 35,</span><br><span class="line">  loc:</span><br><span class="line">   SourceLocation &#123;</span><br><span class="line">     start: Position &#123; line: 1, column: 0 &#125;,</span><br><span class="line">     end: Position &#123; line: 1, column: 35 &#125; &#125;,</span><br><span class="line">  specifiers:</span><br><span class="line">   [ Node &#123;</span><br><span class="line">       type: &apos;ImportDefaultSpecifier&apos;,</span><br><span class="line">       start: 7,</span><br><span class="line">       end: 14,</span><br><span class="line">       loc: [SourceLocation],</span><br><span class="line">       local: [Node] &#125; ],</span><br><span class="line">  source:</span><br><span class="line">   Node &#123;</span><br><span class="line">     type: &apos;StringLiteral&apos;,</span><br><span class="line">     start: 20,</span><br><span class="line">     end: 34,</span><br><span class="line">     loc: SourceLocation &#123; start: [Position], end: [Position] &#125;,</span><br><span class="line">     extra: &#123; rawValue: &apos;./message.js&apos;, raw: &apos;\&apos;./message.js\&apos;&apos; </span><br><span class="line">     &#125;,</span><br><span class="line">     value: &apos;./message.js&apos; //根据这得到依赖文件</span><br><span class="line">   &#125; &#125;</span><br></pre></td></tr></table></figure>

<p>得到依赖文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">const fs = require(&apos;fs&apos;);</span><br><span class="line">const parser = require(&apos;@babel/parser&apos;);</span><br><span class="line">const traverse =require(&apos;@babel/traverse&apos;).default  </span><br><span class="line"></span><br><span class="line">const moduleAnalyser = (filename)=&gt; &#123;</span><br><span class="line">  const content = fs.readFileSync(filename,&apos;utf-8&apos;);</span><br><span class="line">  const ast = parser.parse(content,&#123;</span><br><span class="line">    sourceType:&apos;module&apos;  </span><br><span class="line">  &#125;);</span><br><span class="line">  const dependencies = [] //存放依赖</span><br><span class="line">  traverse(ast,&#123;</span><br><span class="line">    ImportDeclaration(&#123;node&#125;)&#123;  </span><br><span class="line">      dependencies.push(node.source.value); //将依赖文件push进去</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  console.log(dependencies) //[ &apos;./message.js&apos; ]</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">moduleAnalyser(&apos;./src/index.js&apos;)</span><br></pre></td></tr></table></figure>

<p>但是我们要求打包的时候，不能是相对路径要是绝对路径，即使是相对路径，也要是想对根路径的相对路径，不能是相对src的路径。我们还需要引入node下边的另一个模块path：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">const fs = require(&apos;fs&apos;);</span><br><span class="line">const parser = require(&apos;@babel/parser&apos;);</span><br><span class="line">const traverse =require(&apos;@babel/traverse&apos;).default  </span><br><span class="line">const path = require(&apos;path&apos;) //引入</span><br><span class="line"></span><br><span class="line">const moduleAnalyser = (filename)=&gt; &#123;</span><br><span class="line">  const content = fs.readFileSync(filename,&apos;utf-8&apos;);</span><br><span class="line">  const ast = parser.parse(content,&#123;</span><br><span class="line">    sourceType:&apos;module&apos;  </span><br><span class="line">  &#125;);</span><br><span class="line">  const dependencies = [] </span><br><span class="line">  traverse(ast,&#123;</span><br><span class="line">    ImportDeclaration(&#123;node&#125;)&#123;  </span><br><span class="line">      const dirname = path.dirname(filename)//index.js的当前目录-./src</span><br><span class="line">      const newFile = path.join(dirname,node.source.value);</span><br><span class="line">      console.log(newFile);//src\message.js</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">moduleAnalyser(&apos;./src/index.js&apos;)</span><br></pre></td></tr></table></figure>

<p>我们希望dependencies 中既有相对路径又有绝对路径：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">const fs = require(&apos;fs&apos;);</span><br><span class="line">const parser = require(&apos;@babel/parser&apos;);</span><br><span class="line">const traverse =require(&apos;@babel/traverse&apos;).default  </span><br><span class="line">const path = require(&apos;path&apos;) //引入</span><br><span class="line"></span><br><span class="line">const moduleAnalyser = (filename)=&gt; &#123;</span><br><span class="line">  const content = fs.readFileSync(filename,&apos;utf-8&apos;);</span><br><span class="line"></span><br><span class="line">  const ast = parser.parse(content,&#123;</span><br><span class="line">    sourceType:&apos;module&apos;  </span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  const dependencies = &#123;&#125;</span><br><span class="line">  traverse(ast,&#123;</span><br><span class="line">    ImportDeclaration(&#123; node &#125;)&#123;  </span><br><span class="line">      const dirname = path.dirname(filename)</span><br><span class="line">      const newFile = &apos;./&apos; + path.join(dirname, node.source.value);</span><br><span class="line">      dependencies[node.source.value] = newFile;</span><br><span class="line">      </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">moduleAnalyser(&apos;./src/index.js&apos;)</span><br></pre></td></tr></table></figure>

<p>这样既有相对路径又有绝对路径，在以后打包中比较方便。</p>
<p>现在我们已经分析出来了入口文件的依赖文件，将之返回即可：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">return &#123;</span><br><span class="line">  filename,</span><br><span class="line">  dependencies</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是index.js文件中我们还是ES Module形式的代码，我们还需要将它转化成浏览器可以识别的代码：</p>
<blockquote>
<p>npm install @babel/core –save</p>
</blockquote>
<blockquote>
<p>npm install @babel/preset-env –save </p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">const fs = require(&apos;fs&apos;);</span><br><span class="line">const parser = require(&apos;@babel/parser&apos;);</span><br><span class="line">const traverse =require(&apos;@babel/traverse&apos;).default  </span><br><span class="line">const path = require(&apos;path&apos;) </span><br><span class="line">const babel = require(&apos;@babel/core&apos;)//引入</span><br><span class="line"></span><br><span class="line">const moduleAnalyser = (filename)=&gt; &#123;</span><br><span class="line">  const content = fs.readFileSync(filename,&apos;utf-8&apos;);</span><br><span class="line"></span><br><span class="line">  const ast = parser.parse(content,&#123;</span><br><span class="line">    sourceType:&apos;module&apos;  </span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  const dependencies = &#123;&#125;</span><br><span class="line">  traverse(ast,&#123;</span><br><span class="line">    ImportDeclaration(&#123; node &#125;)&#123;  </span><br><span class="line">      const dirname = path.dirname(filename)</span><br><span class="line">      const newFile = &apos;./&apos; + path.join(dirname, node.source.value);</span><br><span class="line">      dependencies[node.source.value] = newFile;</span><br><span class="line">      </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  const &#123;code&#125; = babel.transformFromAst(ast,null,&#123;</span><br><span class="line">    presets:[&quot;@babel/preset-env&quot;] </span><br><span class="line">  &#125;)</span><br><span class="line">  // transformFromAst将抽象语法树转换为浏览器可以运行的代码返回一个对象，</span><br><span class="line">  return &#123;</span><br><span class="line">    filename,</span><br><span class="line">    dependencies,</span><br><span class="line">    code //将code返回出去</span><br><span class="line">  &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">moduleAnalyser(&apos;./src/index.js&apos;)</span><br></pre></td></tr></table></figure>

<p>输出的内容是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123; filename: &apos;./src/index.js&apos;, //入口文件</span><br><span class="line">  dependencies: &#123; &apos;./message.js&apos;: &apos;./src\\message.js&apos; &#125;, //依赖关系</span><br><span class="line">  code: //转化后的浏览器可识别的代码</span><br><span class="line">   &apos;&quot;use strict&quot;;\n\nvar _message = _interopRequireDefault(require(&quot;./message.js&quot;));\n\nfunction _interopRequireDefault(obj) &#123; return obj &amp;&amp; obj.__esModule ?</span><br><span class="line">obj : &#123; &quot;default&quot;: obj &#125;; &#125;\n\nconsole.log(_message[&quot;default&quot;]);&apos; &#125;</span><br></pre></td></tr></table></figure>

<h3 id="Dependencies-Graph-依赖图谱"><a href="#Dependencies-Graph-依赖图谱" class="headerlink" title="Dependencies Graph 依赖图谱"></a>Dependencies Graph 依赖图谱</h3><p>上边我们已经完成了对index.js文件的分析，但是index.js还依赖message.js文件，我们需要对依赖文件继续进行分析。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">const fs = require(&apos;fs&apos;);</span><br><span class="line">const parser = require(&apos;@babel/parser&apos;);</span><br><span class="line">const traverse =require(&apos;@babel/traverse&apos;).default  </span><br><span class="line">const path = require(&apos;path&apos;) //引入</span><br><span class="line">const babel = require(&apos;@babel/core&apos;)</span><br><span class="line"></span><br><span class="line">const moduleAnalyser = (filename)=&gt; &#123;</span><br><span class="line">  const content = fs.readFileSync(filename,&apos;utf-8&apos;);</span><br><span class="line">  const ast = parser.parse(content,&#123;</span><br><span class="line">    sourceType:&apos;module&apos;  </span><br><span class="line">  &#125;);</span><br><span class="line">  const dependencies = &#123;&#125;</span><br><span class="line">  traverse(ast,&#123;</span><br><span class="line">    ImportDeclaration(&#123; node &#125;)&#123;  </span><br><span class="line">      const dirname = path.dirname(filename)</span><br><span class="line">      const newFile = &apos;./&apos; + path.join(dirname, node.source.value);</span><br><span class="line">      dependencies[node.source.value] = newFile;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  const &#123;code&#125; = babel.transformFromAst(ast,null,&#123;</span><br><span class="line">    presets:[&quot;@babel/preset-env&quot;]</span><br><span class="line">  &#125;)</span><br><span class="line">  return &#123;</span><br><span class="line">    filename,</span><br><span class="line">    dependencies,</span><br><span class="line">    code</span><br><span class="line">  &#125;</span><br><span class="line"> &#125;</span><br><span class="line">// ***************************************</span><br><span class="line">const makeDependenciesGraph = (entry) =&gt; &#123;</span><br><span class="line">  const entryModule = moduleAnalyser(entry);</span><br><span class="line">  const graphArray = [entryModule];</span><br><span class="line">  for(let i = 0;i&lt;graphArray.length;i++)&#123;</span><br><span class="line">    const item = graphArray[i];</span><br><span class="line">    const &#123;dependencies&#125; =item;</span><br><span class="line">    if(dependencies)&#123;</span><br><span class="line">      for(let j in dependencies)&#123;</span><br><span class="line">        graphArray.push(</span><br><span class="line">          moduleAnalyser(dependencies[j])</span><br><span class="line">        )</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  // 数组不好处理转换成对象</span><br><span class="line">  const graph = &#123;&#125;;</span><br><span class="line">  graphArray.forEach( e =&gt; &#123;</span><br><span class="line">    graph[e.filename] = &#123;</span><br><span class="line">      dependencies : e.dependencies,</span><br><span class="line">      code : e.code </span><br><span class="line">    &#125; </span><br><span class="line">  &#125;)</span><br><span class="line">  return graph;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const graphInfo = makeDependenciesGraph(&apos;./src/index.js&apos;);</span><br><span class="line">console.log(graphInfo)</span><br><span class="line"></span><br><span class="line">// ***************************************</span><br></pre></td></tr></table></figure>

<p>可以看到打印出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123; &apos;./src/index.js&apos;:</span><br><span class="line">   &#123; dependencies: &#123; &apos;./message.js&apos;: &apos;./src\\message.js&apos; &#125;,</span><br><span class="line">     code:</span><br><span class="line">      &apos;&quot;use strict&quot;;\n\nvar _message = _interopRequireDefault(require(&quot;./message.js&quot;));\n\nfunction _interopRequireDefault(obj) &#123; return obj &amp;&amp; obj.__esModule ? obj : &#123; &quot;default&quot;: obj &#125;; &#125;\n\nconsole.log(_message[&quot;default&quot;]);&apos; &#125;,</span><br><span class="line">      </span><br><span class="line">  &apos;./src\\message.js&apos;:</span><br><span class="line">   &#123; dependencies: &#123; &apos;./word.js&apos;: &apos;./src\\word.js&apos; &#125;,</span><br><span class="line">     code:</span><br><span class="line">      &apos;&quot;use strict&quot;;\n\nObject.defineProperty(exports, &quot;__esModule&quot;, &#123;\n  value: true\n&#125;);\nexports[&quot;default&quot;] = void 0;\n\nvar _word = require(&quot;./word.js&quot;);\n\nvar message = &quot;say &quot;.concat(_word.word);\nvar _default = message;\nexports[&quot;default&quot;] = _default;&apos; &#125;,</span><br><span class="line">      </span><br><span class="line">  &apos;./src\\word.js&apos;:</span><br><span class="line">   &#123; dependencies: &#123;&#125;,</span><br><span class="line">     code:</span><br><span class="line">      &apos;&quot;use strict&quot;;\n\nObject.defineProperty(exports, &quot;__esModule&quot;, &#123;\n  value: true\n&#125;);\nexports.word = void 0;\nvar word = \&apos;hello\&apos;;\nexports.word = word;&apos; &#125; &#125;</span><br></pre></td></tr></table></figure>

<p>这就是我们所说的依赖图谱，清晰地展示了文件之间的依赖关系，并且将每个文件都转化为浏览器可以运行的代码。</p>
<h3 id="生成代码"><a href="#生成代码" class="headerlink" title="生成代码"></a>生成代码</h3><p>上边我们已经拿到了依赖图谱，但是我们发现里边用了require方法，同时还有exports对象，浏览器中并不存在require方法，也不存在exports对象，直接去运行还是会报错说缺少一个方法和对象，接下来就是生成真正可以在浏览器运行的代码，我们要构造require方法和exports对象：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">const fs = require(&apos;fs&apos;);</span><br><span class="line">const parser = require(&apos;@babel/parser&apos;);</span><br><span class="line">const traverse =require(&apos;@babel/traverse&apos;).default  </span><br><span class="line">const path = require(&apos;path&apos;) //引入</span><br><span class="line">const babel = require(&apos;@babel/core&apos;)</span><br><span class="line"></span><br><span class="line">const moduleAnalyser = (filename)=&gt; &#123;</span><br><span class="line">  const content = fs.readFileSync(filename,&apos;utf-8&apos;);</span><br><span class="line">  const ast = parser.parse(content,&#123;</span><br><span class="line">    sourceType:&apos;module&apos;  </span><br><span class="line">  &#125;);</span><br><span class="line">  const dependencies = &#123;&#125;</span><br><span class="line">  traverse(ast,&#123;</span><br><span class="line">    ImportDeclaration(&#123; node &#125;)&#123;  </span><br><span class="line">      const dirname = path.dirname(filename)</span><br><span class="line">      const newFile = &apos;./&apos; + path.join(dirname, node.source.value);</span><br><span class="line">      dependencies[node.source.value] = newFile;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  const &#123;code&#125; = babel.transformFromAst(ast,null,&#123;</span><br><span class="line">    presets:[&quot;@babel/preset-env&quot;]</span><br><span class="line">  &#125;)</span><br><span class="line">  return &#123;</span><br><span class="line">    filename,</span><br><span class="line">    dependencies,</span><br><span class="line">    code</span><br><span class="line">  &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">const makeDependenciesGraph = (entry) =&gt; &#123;</span><br><span class="line">  const entryModule = moduleAnalyser(entry);</span><br><span class="line">  const graphArray = [entryModule];</span><br><span class="line">  for(let i = 0;i&lt;graphArray.length;i++)&#123;</span><br><span class="line">    const item = graphArray[i];</span><br><span class="line">    const &#123;dependencies&#125; =item;</span><br><span class="line">    if(dependencies)&#123;</span><br><span class="line">      for(let j in dependencies)&#123;</span><br><span class="line">        graphArray.push(</span><br><span class="line">          moduleAnalyser(dependencies[j])</span><br><span class="line">        )</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  // 数组不好处理转换成对象</span><br><span class="line">  const graph = &#123;&#125;;</span><br><span class="line">  graphArray.forEach( e =&gt; &#123;</span><br><span class="line">    graph[e.filename] = &#123;</span><br><span class="line">      dependencies : e.dependencies,</span><br><span class="line">      code : e.code </span><br><span class="line">    &#125; </span><br><span class="line">  &#125;)</span><br><span class="line">  return graph;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const generateCode = (entry) =&gt; &#123;</span><br><span class="line">  const graph = JSON.stringify(makeDependenciesGraph(entry));</span><br><span class="line">  return `</span><br><span class="line">    (function(graph)&#123;</span><br><span class="line"></span><br><span class="line">      function require(module)&#123;</span><br><span class="line"></span><br><span class="line">        function LocalRequire(relativePath)&#123;</span><br><span class="line">          return require(graph[module].dependencies[relativePath])</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        var exports = &#123;&#125;;  //不加分号报错！！</span><br><span class="line"></span><br><span class="line">        (function(require,exports,code)&#123;</span><br><span class="line">          eval(code) </span><br><span class="line">        &#125;)(LocalRequire,exports,graph[module].code);</span><br><span class="line"></span><br><span class="line">        return exports;</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      require(&apos;$&#123;entry&#125;&apos;)</span><br><span class="line"></span><br><span class="line">    &#125;)($&#123;graph&#125;);</span><br><span class="line">  `</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const code = generateCode(&apos;./src/index.js&apos;);</span><br><span class="line">console.log(code)</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/05/19/webpack-编写plugin/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jerry">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jerry's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/05/19/webpack-编写plugin/" itemprop="url">webpack-编写plugin</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-05-19T19:19:43+08:00">
                2020-05-19
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/前端/" itemprop="url" rel="index">
                    <span itemprop="name">前端</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>plugin 是在某一时刻帮助我们做某些事。</p>
<p>plugin 是事件驱动或者说是发布订阅模式。</p>
<h3 id="定义一个简单的插件"><a href="#定义一个简单的插件" class="headerlink" title="定义一个简单的插件"></a>定义一个简单的插件</h3><p>plugins/copyright-webpack-plugin.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">class CopyrightWebpackPlugin&#123;</span><br><span class="line">  constructor()&#123;</span><br><span class="line">    console.log(&apos;插件被使用了&apos;)</span><br><span class="line">  &#125;;</span><br><span class="line">  apply(compiler)&#123;</span><br><span class="line"></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module.exports = CopyrightWebpackPlugin;</span><br></pre></td></tr></table></figure>

<p>由此可以看到，插件是一个类，所以我们使用插件的时候需要new plugin</p>
<p>webpack.config.js：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">const path = require(&apos;path&apos;);</span><br><span class="line">const CopyrightWebpackPlugin = require(&apos;./plugins/copyright-webpack-plugin&apos;)</span><br><span class="line">module.exports = &#123;</span><br><span class="line">  mode:&apos;development&apos;,</span><br><span class="line">  entry:&#123;</span><br><span class="line">    main:&apos;./src/index.js&apos;,</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins:[</span><br><span class="line">    new CopyrightWebpackPlugin()</span><br><span class="line">  ],</span><br><span class="line">  output:&#123;</span><br><span class="line">    filename:&apos;[name].js&apos;,</span><br><span class="line">    path:path.resolve(__dirname,&apos;dist&apos;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>之后打包可以看到，我们”插件被使用了”打印出来。至此，编写插件的基本结构已经说明。</p>
<h3 id="传参数"><a href="#传参数" class="headerlink" title="传参数"></a>传参数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">new CopyrightWebpackPlugin(&#123;</span><br><span class="line">  name:&apos;jerry&apos; //对象传参</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>获取参数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">class CopyrightWebpackPlugin&#123;</span><br><span class="line">  constructor(options)&#123; //options获取参数</span><br><span class="line">    console.log(options)</span><br><span class="line">  &#125;;</span><br><span class="line">  apply(compiler)&#123;</span><br><span class="line"></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module.exports = CopyrightWebpackPlugin;</span><br></pre></td></tr></table></figure>

<h3 id="实现在打包完将文件放到dist之前，向dist中添加copyright-txt"><a href="#实现在打包完将文件放到dist之前，向dist中添加copyright-txt" class="headerlink" title="实现在打包完将文件放到dist之前，向dist中添加copyright.txt"></a>实现在打包完将文件放到dist之前，向dist中添加copyright.txt</h3><p>我们说plugin是在特定的时间帮我们做某些事，那么特定的时间都有哪些呢，官网上定义了<a href="https://www.webpackjs.com/api/compiler-hooks/" target="_blank" rel="noopener">compilee.hooks</a>。hooks就是“勾子”，Vue中生命周期函数就是勾子，指的是在某时刻自动执行的函数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">class CopyrightWebpackPlugin &#123;</span><br><span class="line">  apply(compiler) &#123;</span><br><span class="line">    //compiler所有的源代码以及webpack.config.js中的内容</span><br><span class="line">    // emit 为异步的函数</span><br><span class="line">    compiler.hooks.emit.tapAsync(</span><br><span class="line">      &quot;CopyrightWebpackPlugin&quot;,</span><br><span class="line">      (compilation, cb) =&gt; &#123;</span><br><span class="line">        //compilation是与本次打包相关的内容</span><br><span class="line">        compilation.assets[&quot;copyright.txt&quot;] = &#123;</span><br><span class="line">          //compilation.assets ：打包后都有哪些文件</span><br><span class="line">          source: function () &#123; //内容</span><br><span class="line">            return &quot;copyright by jerry&quot;;</span><br><span class="line">          &#125;,</span><br><span class="line">          size:function()&#123; //长度</span><br><span class="line">            return 18; //文件大小18个字符长度 </span><br><span class="line">          &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        cb(); //异步的必须在最后调用回调函数</span><br><span class="line">      &#125;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module.exports = CopyrightWebpackPlugin;</span><br></pre></td></tr></table></figure>

<p>compiler 中还有很多时刻，下面找一个同步（SyncHook）的时刻为例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">class CopyrightWebpackPlugin &#123;</span><br><span class="line">  apply(compiler) &#123;</span><br><span class="line">    //compiler所有的源代码以及webpack.config.js中的内容</span><br><span class="line">    </span><br><span class="line">    //compile为同步的</span><br><span class="line">    compiler.hooks.compile.tap(&apos;CopyrightWebpackPlugin&apos;,(compilation)=&gt;&#123;</span><br><span class="line">      console.log(&apos;同步，不需要callback，不需要tapAsync&apos;)</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    // emit 为异步的</span><br><span class="line">    compiler.hooks.emit.tapAsync(</span><br><span class="line">      &quot;CopyrightWebpackPlugin&quot;,</span><br><span class="line">      (compilation, cb) =&gt; &#123;</span><br><span class="line">        //compilation是与本次打包相关的内容</span><br><span class="line">        compilation.assets[&quot;copyright.txt&quot;] = &#123;</span><br><span class="line">          //compilation.assets ：打包后都有哪些文件</span><br><span class="line">          source: function () &#123; //内容</span><br><span class="line">            return &quot;copyright by jerry&quot;;</span><br><span class="line">          &#125;,</span><br><span class="line">          size:function()&#123; //长度</span><br><span class="line">            return 18; //文件大小18个字符长度 </span><br><span class="line">          &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        cb(); //异步的必须在最后调用回调函数</span><br><span class="line">      &#125;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module.exports = CopyrightWebpackPlugin;</span><br></pre></td></tr></table></figure>

<h3 id="node调试工具查看传入参数compilation等里边的属性"><a href="#node调试工具查看传入参数compilation等里边的属性" class="headerlink" title="node调试工具查看传入参数compilation等里边的属性"></a>node调试工具查看传入参数compilation等里边的属性</h3><p>在package.json 中配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&quot;debug&quot;:&quot;node node_modules/webpack/bin/webpack.js&quot;  </span><br><span class="line">//等同于&quot;build&quot;: &quot;webpack&quot;,不同是现在可以传递参数</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">    &quot;debug&quot;:&quot;node --inspect --inspect-brk  node_modules/webpack/bin/webpack.js&quot;</span><br><span class="line">// inspect开启node调试工具，inspect-brk在webpack.js第一行打断点</span><br></pre></td></tr></table></figure>

<p>之后：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">class CopyrightWebpackPlugin &#123;</span><br><span class="line">  apply(compiler) &#123;</span><br><span class="line">  </span><br><span class="line">    compiler.hooks.compile.tap(&apos;CopyrightWebpackPlugin&apos;,(compilation)=&gt;&#123;</span><br><span class="line">      console.log(&apos;同步，不需要callback，不需要tapAsync&apos;)</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    compiler.hooks.emit.tapAsync(</span><br><span class="line">      &quot;CopyrightWebpackPlugin&quot;,</span><br><span class="line">      (compilation, cb) =&gt; &#123;</span><br><span class="line">        //打断点！！！！！！！！！</span><br><span class="line">        debugger;</span><br><span class="line">        compilation.assets[&quot;copyright.txt&quot;] = &#123;</span><br><span class="line">         source: function () &#123; </span><br><span class="line">            return &quot;copyright by jerry&quot;;</span><br><span class="line">          &#125;,</span><br><span class="line">          size:function()&#123; </span><br><span class="line">            return 18; </span><br><span class="line">          &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        cb(); //异步的必须在最后调用回调函数</span><br><span class="line">      &#125;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module.exports = CopyrightWebpackPlugin;</span><br></pre></td></tr></table></figure>

<p>运行：</p>
<blockquote>
<p>npm run debug</p>
</blockquote>
<p>然后打开浏览器控制台（随便哪个网页），你会看到有一个node图标，点开后会发现在我们在webpack.js中第一行打的断点处，之后下一步，会看到停在业务逻辑中打的断点处，这时候你可以将鼠标直接放到compilation上，就会显示compilation的详细内容，或者你也可以在watch中添加compilation，之后也会显示详细内容：</p>
<p><img src="https://s1.ax1x.com/2020/05/19/YIKYZR.png" alt="image"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/05/19/webpack-编写loader/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jerry">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jerry's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/05/19/webpack-编写loader/" itemprop="url">webpack-编写loader</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-05-19T17:41:03+08:00">
                2020-05-19
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/前端/" itemprop="url" rel="index">
                    <span itemprop="name">前端</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>编写replaceLoader，完成字符串的替换。</li>
</ul>
<p>index.js：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">console.log(&apos;hello jerry&apos;)</span><br></pre></td></tr></table></figure>

<p>loaders/replaceLoaders中编写：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">module.exports = function(source)&#123;</span><br><span class="line">    //不可以写箭头函数，使用loader会调用this，箭头函数this会改变</span><br><span class="line">    //接受调用loader的文件里边的内容为参数</span><br><span class="line">    return source.replace(&apos;jerry&apos;,&apos;TOM AND JERRY&apos;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>webpack.config.js 中配置使用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">const path = require(&apos;path&apos;)</span><br><span class="line">module.exports = &#123;</span><br><span class="line">    mode:&apos;development&apos;,</span><br><span class="line">    entry:&#123;</span><br><span class="line">        main:&apos;./src/index.js&apos;,</span><br><span class="line">    &#125;,</span><br><span class="line">    module:&#123;</span><br><span class="line">        rules:[</span><br><span class="line">            &#123;</span><br><span class="line">                test:/\.js/,</span><br><span class="line">                use:[</span><br><span class="line">                   //写路径，非文件名</span><br><span class="line">                   path.resolve(__dirname,&apos;./loaders/replaceLoader.js&apos;)</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    output:&#123;</span><br><span class="line">        filename:&apos;[name].js&apos;,</span><br><span class="line">        path:path.resolve(__dirname,&apos;dist&apos;)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>再去打包后的文件发现，原来的hello jerry 变成了 hello TOM AND JERRY</p>
<p>至此，最简单的一个loader就编写完成了。</p>
<h3 id="loaderUtils"><a href="#loaderUtils" class="headerlink" title="loaderUtils"></a>loaderUtils</h3><p>有的时候，我们还会对loader进行配置。比如说：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">const path = require(&quot;path&quot;);</span><br><span class="line">module.exports = &#123;</span><br><span class="line">  mode: &quot;development&quot;,</span><br><span class="line">  entry: &#123;</span><br><span class="line">    main: &quot;./src/index.js&quot;,</span><br><span class="line">  &#125;,</span><br><span class="line">  module: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: /\.js/,</span><br><span class="line">        use: [</span><br><span class="line">          &#123;</span><br><span class="line">            loader: path.resolve(__dirname, &quot;./loaders/replaceLoader.js&quot;),</span><br><span class="line">            options:&#123;</span><br><span class="line">                name:&apos;is me&apos;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: &quot;[name].js&quot;,</span><br><span class="line">    path: path.resolve(__dirname, &quot;dist&quot;),</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>我们自己编写的loader通过this，获取传过来的options参数，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">module.exports = function(source)&#123;</span><br><span class="line">    //不可以写箭头函数，使用loader会调用this，箭头函数this会改变</span><br><span class="line">    console.log(this.query) //log=---&gt; &#123; name: &apos;is me&apos; &#125;</span><br><span class="line">    //我们可以将TOM AND JERRY通过options传过来，然后可以替换任意值</span><br><span class="line">    return source.replace(&apos;jerry&apos;,&apos;TOM AND JERRY&apos;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是，有的时候传进来的参数会和我们想象的不一样，通过this.query获取参数不方便，官方推荐使用loader-utils来帮我们分析传进来的参数，首先安装</p>
<blockquote>
<p>npm install loader-utils -D</p>
</blockquote>
<p>之后我们不需要使用this.query获取参数，使用loader-utils即可：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">const loaderUtils = require(&apos;loader-utils&apos;)</span><br><span class="line"></span><br><span class="line">module.exports = function(source)&#123;</span><br><span class="line">    const options = loaderUtils.getOptions(this) //自动分析this.query然后将参数返回给options</span><br><span class="line">    return source.replace(&apos;jerry&apos;,options.name) //&apos;hello is me&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>光网上还有相关<a href="https://www.webpackjs.com/api/loaders/" target="_blank" rel="noopener">loader API</a>的更多配置。</p>
<h3 id="this-callback"><a href="#this-callback" class="headerlink" title="this.callback"></a>this.callback</h3><p>再比如，有时候我们可能希望返回更多的东西，就可以利用callback:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">this.callback(</span><br><span class="line">  err: Error | null, </span><br><span class="line">  content: string | Buffer, //loader解析过后的新的源代码</span><br><span class="line">  sourceMap?: SourceMap, //返回sourceMap，没有为空</span><br><span class="line">  meta?: any //其余想返回的东西</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">const loaderUtils = require(&apos;loader-utils&apos;)</span><br><span class="line"></span><br><span class="line">module.exports = function(source)&#123;</span><br><span class="line">    const options = loaderUtils.getOptions(this) //自动分析this.query然后将参数返回给options</span><br><span class="line">    const result = source.replace(&apos;jerry&apos;,options.name)</span><br><span class="line">    this.callback(null,result)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="this-async"><a href="#this-async" class="headerlink" title="this.async"></a>this.async</h3><p>有的时候，我们代码里还常常会存在异步操作：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">const loaderUtils = require(&apos;loader-utils&apos;)</span><br><span class="line"></span><br><span class="line">module.exports = function(source)&#123;</span><br><span class="line">    const options = loaderUtils.getOptions(this) //自动分析this.query然后将参数返回给options</span><br><span class="line">    const result = source.replace(&apos;jerry&apos;,options.name)</span><br><span class="line">    setTimeout(()=&gt; &#123;</span><br><span class="line">        return result</span><br><span class="line">    &#125;,1000)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>会报错：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Module build failed: Error: Final loader (./loaders/replaceLoader.js) didn&apos;t return a Buffer or String</span><br></pre></td></tr></table></figure>

<p>那是因为异步之后，没有立即返回结果，而是等了一秒。</p>
<p>这时候需要用到this.async:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">const loaderUtils = require(&apos;loader-utils&apos;)</span><br><span class="line"></span><br><span class="line">module.exports = function(source)&#123;</span><br><span class="line">    const options = loaderUtils.getOptions(this) </span><br><span class="line">    const callback = this.async(); //返回this.callback</span><br><span class="line">    setTimeout(()=&gt; &#123;</span><br><span class="line">        const result = source.replace(&apos;jerry&apos;,options.name)</span><br><span class="line">        callback(null,result);</span><br><span class="line">    &#125;,1000)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用两个loader"><a href="#使用两个loader" class="headerlink" title="使用两个loader"></a>使用两个loader</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">rules: [</span><br><span class="line">  &#123;</span><br><span class="line">    test: /\.js/,</span><br><span class="line">    use: [</span><br><span class="line">      &#123;</span><br><span class="line">        loader: path.resolve(__dirname, &quot;./loaders/replaceLoader.js&quot;),</span><br><span class="line">        options:&#123;</span><br><span class="line">            name:&apos;is me&apos;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        loader: path.resolve(__dirname, &quot;./loaders/replaceLoaderAsync.js&quot;),</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">],</span><br></pre></td></tr></table></figure>

<h3 id="resolveLoader"><a href="#resolveLoader" class="headerlink" title="resolveLoader"></a>resolveLoader</h3><p>resolveLoader 的作用就是，当我们引用loader时，不需要引用路径，只写名字就可以：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">const path = require(&quot;path&quot;);</span><br><span class="line">module.exports = &#123;</span><br><span class="line">  mode: &quot;development&quot;,</span><br><span class="line">  entry: &#123;</span><br><span class="line">    main: &quot;./src/index.js&quot;,</span><br><span class="line">  &#125;,</span><br><span class="line">  resolveLoader:&#123;</span><br><span class="line">    modules:[&apos;node_modules&apos;,&apos;./loaders&apos;] //使用loader时先去node_modules里面找，然后去loaders里边找</span><br><span class="line">  &#125;,</span><br><span class="line">  module: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: /\.js/,</span><br><span class="line">        use: [</span><br><span class="line">          &#123;</span><br><span class="line">            loader: &apos;replaceLoader&apos;, //只写名字就好了</span><br><span class="line">            options:&#123;</span><br><span class="line">                name:&apos;is me&apos;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: &quot;[name].js&quot;,</span><br><span class="line">    path: path.resolve(__dirname, &quot;dist&quot;),</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="loader-可以用来干什么"><a href="#loader-可以用来干什么" class="headerlink" title="loader 可以用来干什么"></a>loader 可以用来干什么</h3><ul>
<li>可以检测代码错误try catch。</li>
<li>国际化网页，根据选择显示中英文。</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/05/19/webpack-多页面打包配置/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jerry">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jerry's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/05/19/webpack-多页面打包配置/" itemprop="url">webpack-多页面打包配置</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-05-19T14:44:56+08:00">
                2020-05-19
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/前端/" itemprop="url" rel="index">
                    <span itemprop="name">前端</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>我们常见的框架react和Vue都是单页面应用，但是也会有想要打包多个页面的情况。</p>
<p>比如有两个js文件home.js和index.js，想要根据这两个文件生成两个HTML文件，并且将打包后的文件挂载到页面上。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">const makePlugins =(configs) =&gt; &#123;</span><br><span class="line">    const plugins = [</span><br><span class="line">        // 公共的plugin</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">//  Object.keys,按照对象的key生成数组</span><br><span class="line">    Object.keys(configs.entry).forEach(item =&gt; &#123;</span><br><span class="line">        plugins.push(</span><br><span class="line">            new HtmlWebpackPlugin(&#123;</span><br><span class="line">                template:&apos;src/index.html&apos;, //模板</span><br><span class="line">                filename:`$&#123;item&#125;.html`, //新生成HTML文件</span><br><span class="line">                chunks:[&apos;runtime&apos;,&apos;vendors&apos;,item] //需要挂下的打包后的文件</span><br><span class="line">            &#125;)</span><br><span class="line">        )</span><br><span class="line">    &#125;)</span><br><span class="line">    return plugins</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">const configs = &#123;</span><br><span class="line">    entry:&#123;</span><br><span class="line">        index:&apos;../src/index.js&apos;,</span><br><span class="line">        home:&apos;../src/home.js&apos;</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins,</span><br><span class="line">    //其他配置项</span><br><span class="line">&#125;</span><br><span class="line">configs.plufins = makePlugins(configs)</span><br><span class="line">module.exports = configs;</span><br></pre></td></tr></table></figure>

<p>之后就会每次动态添加页面，不需要每增加页面去手动增加plugin。</p>
<p>总结下来，多页面配置就是配置多个入口 + 动态添加plugin。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/05/19/webpack-性能优化/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jerry">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jerry's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/05/19/webpack-性能优化/" itemprop="url">webpack-性能优化</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-05-19T14:11:42+08:00">
                2020-05-19
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/前端/" itemprop="url" rel="index">
                    <span itemprop="name">前端</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="提升webpack打包速度的方法"><a href="#提升webpack打包速度的方法" class="headerlink" title="提升webpack打包速度的方法"></a>提升webpack打包速度的方法</h3><h4 id="1-跟上技术迭代（Node，Npm，Yarn"><a href="#1-跟上技术迭代（Node，Npm，Yarn" class="headerlink" title="1. 跟上技术迭代（Node，Npm，Yarn)"></a>1. 跟上技术迭代（Node，Npm，Yarn)</h4><p>每次技术的革新，内部必然会实现优化，及时更新webpack，node环境，安装新版本的npm或者yarn管理工具，打包速度都会有所提升。</p>
<h4 id="2-在尽可能少的模块上应用loader"><a href="#2-在尽可能少的模块上应用loader" class="headerlink" title="2. 在尽可能少的模块上应用loader"></a>2. 在尽可能少的模块上应用loader</h4><p>对于某种类型的文件，部分需要打包，部分不需要打包时使用比如js文件，业务代码是需要打包的，但是node_modules中的js就不需要再次打包了:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    test: /\.js$/,</span><br><span class="line">    exclude: /node_modules/,</span><br><span class="line">    loader:&quot;babel-loader&quot;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>上边的exclude就是性能优化的体现，我们没必要对node_modules中的js代码使用babel-loader实现转换。不仅可以配置exclude，还可以配置include：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include:path.resolve(__dirname,&apos;../src&apos;)</span><br></pre></td></tr></table></figure>

<p>即只对src目录下js文件应用 babel-loader。</p>
<p>但是在对图片文件的处理中，所有的图片文件都需要loader打包之后才可以，所以就不必再设置include或者exclude。</p>
<p>但是合理的使用include和exclude可以在尽可能少的模块上使用loader，从而提高打包速度。</p>
<h4 id="3-Plugin尽可能精简并确保可靠"><a href="#3-Plugin尽可能精简并确保可靠" class="headerlink" title="3. Plugin尽可能精简并确保可靠"></a>3. Plugin尽可能精简并确保可靠</h4><p>在打包生成线上代码的时候，为了使代码尽可能的小，加载速度尽可能的快，需要使用optimize-css-assets-plugin对代码css代码进行压缩，但是在开发环境下并不需要对代码进行压缩，所以在开发环境下不使用这个插件，就节省了打包过程中对代码进行压缩的时间，加快打包速度。</p>
<p>在使用插件的时候最好是使用官方推荐过的插件，使用第三方或者自己编写的插件时，可能解决了一些问题，但是没有通过官方验证，在性能上可能存在不足。</p>
<h4 id="4-resolve参数的合理配置"><a href="#4-resolve参数的合理配置" class="headerlink" title="4. resolve参数的合理配置"></a>4. resolve参数的合理配置</h4><p>可以在webpack配置文件中配置resolve：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">resolve：&#123;</span><br><span class="line">    extensions:[&apos;js&apos;,&apos;jsx&apos;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上设置的含义是，当我们按照如下方式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import xxx from &apos;../index/index&apos;</span><br></pre></td></tr></table></figure>

<p>引入index文件夹下的名称为index的文件时,会先去index文件夹下查找index.js，没有的话再去查找index.jsx，还没有的话报错。</p>
<p>之所以说要合理配置resolve参数，是因为当resolve参数过多时，对每个文件的引入都要去查找一次，会延长打包时间，所以我们经常只对js这一类的业务路基文件配置resolve。</p>
<p>按照以上方式配置好之后，我们引入child文件夹下index.js文件时直接写：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import xxx from &apos;../child&apos;  //只写到文件夹</span><br></pre></td></tr></table></figure>

<p>不会报错。但是引入child文件夹下的child.js文件时直接写到文件夹就会报错。</p>
<p>我们可以在resolve中配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">resolve：&#123;</span><br><span class="line">    extensions:[&apos;js&apos;,&apos;jsx&apos;],</span><br><span class="line">    mainFiles:[&apos;index&apos;,&apos;child&apos;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>引入文件夹的时候，我们先去文件夹下查找index文件，没有的话再去查找child文件，但是这样确实会增加打包负担。每次引入一个文件要去查找可能不止一次。</p>
<p>resolve还有其他设置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">resolve：&#123;</span><br><span class="line">    extensions:[&apos;js&apos;,&apos;jsx&apos;],</span><br><span class="line">    mainFiles:[&apos;index&apos;,&apos;child&apos;],</span><br><span class="line">    alias:&#123;</span><br><span class="line">        jerry:path.resolve(__dirname,&apos;../src/child&apos; //给src/child取别名为jerry)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样就可以：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// 将</span><br><span class="line"></span><br><span class="line">import xxx from &apos;../src/child&apos;</span><br><span class="line"></span><br><span class="line">//改为</span><br><span class="line"></span><br><span class="line">import xxx from &apos;jerry&apos;</span><br></pre></td></tr></table></figure>

<p>alias使用场景：文件向下嵌套很多层时，层层引入(‘../a/b/c/d/child’)很麻烦，可以用alias。</p>
<h4 id="5-使用-DllPlugin-提高打包速度"><a href="#5-使用-DllPlugin-提高打包速度" class="headerlink" title="5. 使用 DllPlugin 提高打包速度"></a>5. 使用 DllPlugin 提高打包速度</h4><p>我们常常会引用很多第三方模块，每次打包的时候，都要从node_modules里面取出模块，然后在把这些模块打包到源代码之中。这个过程中，会消耗一定的打包时间。但是事实上，每次打包，这些第三方模块的内容并没有改变，每次打包实属浪费。因此，我们希望只打包一次，之后再次打包时，直接使用第一次打包好了大模块。</p>
<p>为第三方模块单独创建一个配置文件，webpack.dll.js，配置如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">const path = require(&apos;path&apos;);</span><br><span class="line">const webapck = require(&apos;webpack&apos;);</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">    mode:&apos;production&apos;,</span><br><span class="line">    entry:&#123;</span><br><span class="line">        vendors:[&apos;react&apos;,&apos;react-dom&apos;,&apos;lodash&apos;]//对第三方文件打包</span><br><span class="line">    &#125;,</span><br><span class="line">    output:&#123;</span><br><span class="line">        filename:&apos;[name].dll.js&apos;,//打包后的文件放到vendors.dll.js文件中</span><br><span class="line">        path:path.resolve(__filename,&apos;../dll&apos;);//存放到dll目录下</span><br><span class="line">        library:&apos;[name]&apos;//将打包好的第三方模块以全局变量的形式暴露出去</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins:[</span><br><span class="line">    //DllPlugin对暴露出去的全局变量中的全局代码进行分析，生成manifest.json映射文件</span><br><span class="line">        new webapck.DllPlugin(&#123;</span><br><span class="line">            name:&apos;[name]&apos;,</span><br><span class="line">            path:path.resolve(__dirname,&apos;../dll/[name].manifest.json&apos;)</span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后在package.json中配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;build:dll&quot;: &quot;webpack --config ./build/webpack.dll.js&quot;</span><br></pre></td></tr></table></figure>

<p>之后运行npm run build:dll就可以生成两个文件：vendors.dll.js和映射文件vendors.manifest.json</p>
<p>但是我们打包线上代码和开发代码时会用不同的配置文件，但是他们存在公共的配置文件webpack.common.js,我们需要在其中配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">new AddAssetHtmlWbpackPludin(&#123;</span><br><span class="line">    manifest:path.resolve(__dirname,&apos;../dll/vendors.dll.js&apos;)</span><br><span class="line">&#125;)</span><br><span class="line">new webpack.DllReferencePlugin(&#123;</span><br><span class="line">    manifest:path.resolve(__dirname,&apos;../dll/vendors.manifest.json&apos;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>之后执行npm run dev 或者 npm run build时DllReferencePlugin会结合传入的映射文件，打包后的文件vendoe.dll.js和引入的第三方模块，分析模块是否在vendoe.dll.js中已经打包好，如果打包好了，就不在去node_modules中分析打包了。</p>
<p>AddAssetHtmlWbpackPludin负责将打包后的vendors.dll.js文件放到HTML文件上去(挂载到页面上)，然后才会出现全局变量。</p>
<p>如果我们想把每个模块单独打包一个js文件，那么我们就需要为每个文件配置插件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">new AddAssetHtmlWbpackPludin(&#123;</span><br><span class="line">    manifest:path.resolve(__dirname,&apos;../dll/vendors.dll.js&apos;)</span><br><span class="line">&#125;)</span><br><span class="line">new webpack.DllReferencePlugin(&#123;</span><br><span class="line">    manifest:path.resolve(__dirname,&apos;../dll/vendors.manifest.json&apos;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>每次引入插件都修改的话很麻烦，那么就需要用到node去分析dll文件夹下有几个js文件，有几个manifest.json文件，为我们动态的添加插件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">const fs = require(&apos;fs&apos;);//引入node的核心模块</span><br><span class="line"></span><br><span class="line">//都dll文件夹下的所有内容</span><br><span class="line">const files = fs.readdirSync(path.resolve(__dirnamem,&apos;../dll&apos;) );</span><br><span class="line">const plufins=[</span><br><span class="line">  //别的plugins</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">files.forEach(file =&gt; &#123;</span><br><span class="line">    if(/.*\.dll.js/.test(file))&#123;</span><br><span class="line">        plugins.push(new    AddAssetHtmlWbpackPludin(&#123;</span><br><span class="line">          manifest:path.resolve(__dirname,&apos;../dll&apos;,flie)</span><br><span class="line">        &#125;))</span><br><span class="line">    &#125;</span><br><span class="line">    if(/.*\.manifest.json/.test(file) )&#123;</span><br><span class="line">        plugins.push(new webpack.DllReferencePlugin(&#123;</span><br><span class="line">            manifest:path.resolve(__dirname,&apos;../dll&apos;,file)</span><br><span class="line">        &#125;))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">module.exports=&#123;</span><br><span class="line">    plugins,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="6-控制包文件的大小"><a href="#6-控制包文件的大小" class="headerlink" title="6. 控制包文件的大小"></a>6. 控制包文件的大小</h4><p>TreeShaking  和 SplitChunksPlugin </p>
<h4 id="7-tread-loader-parallel-webpack-happypack多进程打包"><a href="#7-tread-loader-parallel-webpack-happypack多进程打包" class="headerlink" title="7. tread-loader ,parallel-webpack ,happypack多进程打包"></a>7. tread-loader ,parallel-webpack ,happypack多进程打包</h4><h4 id="8-合理使用sourceMap"><a href="#8-合理使用sourceMap" class="headerlink" title="8. 合理使用sourceMap"></a>8. 合理使用sourceMap</h4><p>sourceMap 越详细，打包越慢。合理配置。</p>
<h4 id="9-结合stats分析打包结果"><a href="#9-结合stats分析打包结果" class="headerlink" title="9. 结合stats分析打包结果"></a>9. 结合stats分析打包结果</h4><h4 id="10-开发环境内存编译"><a href="#10-开发环境内存编译" class="headerlink" title="10. 开发环境内存编译"></a>10. 开发环境内存编译</h4><p>开发环境打包时使用的是devServer,不会生成dist文件，而是把编译之后生成的文件放到内存里边，内存的读取比硬盘的读取快得多，也会加快打包速度。</p>
<h4 id="11-开发环境无用插件剔除"><a href="#11-开发环境无用插件剔除" class="headerlink" title="11. 开发环境无用插件剔除"></a>11. 开发环境无用插件剔除</h4><p>在开发环境呀，不必压缩，如果设置成mode=production,做不必要的压缩，也是在浪费时间。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="Jerry">
            
              <p class="site-author-name" itemprop="name">Jerry</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">72</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">6</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">12</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jerry</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
